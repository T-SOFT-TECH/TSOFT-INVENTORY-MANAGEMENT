<div class="p-md">
  <!-- Header -->
  <div class="mb-lg">
    <div class="flex justify-between items-center">
      <div>
        <h1 class="text-2xl font-bold text-gray-900 dark:text-white mb-sm">
          Customers
        </h1>
        <p class="text-gray-600 dark:text-gray-400">
          Manage your customer database
        </p>
      </div>
      <a
        routerLink="new"
        class="inline-flex items-center px-lg py-sm rounded-lg bg-primary-500 text-white
               hover:bg-primary-600 focus:ring-2 focus:ring-primary-500 focus:ring-offset-2
               transition-colors"
      >
        <span class="material-icons mr-sm">add</span>
        Add Customer
      </a>
    </div>
  </div>

  <!-- Filters -->
  <div class="bg-white dark:bg-surface-dark-secondary rounded-lg shadow-sm p-md mb-lg">
    <div class="flex flex-col md:flex-row gap-md">
      <div class="flex-1 relative">
        <input
          type="text"
          [(ngModel)]="searchQuery"
          placeholder="Search customers..."
          class="w-full pl-xl pr-md py-sm rounded-lg border border-gray-300 dark:border-gray-600
                 bg-white dark:bg-surface-dark-primary text-gray-900 dark:text-white
                 focus:ring-2 focus:ring-primary-500 focus:border-transparent"
        >
        <span class="material-icons absolute left-sm top-1/2 -translate-y-1/2 text-gray-400">
          search
        </span>
      </div>

      <select
        [(ngModel)]="selectedStatus"
        class="px-md py-sm rounded-lg border border-gray-300 dark:border-gray-600
               bg-white dark:bg-surface-dark-primary text-gray-900 dark:text-white
               focus:ring-2 focus:ring-primary-500 focus:border-transparent"
      >
        <option value="all">All Statuses</option>
        <option value="active">Active</option>
        <option value="inactive">Inactive</option>
      </select>
    </div>
  </div>

  @if (isLoading()) {
    <div class="flex justify-center items-center h-64">
      <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary-500"></div>
    </div>
  } @else if (getFilteredCustomers().length === 0) {
    <div class="text-center py-xl bg-white dark:bg-surface-dark-secondary rounded-lg shadow">
      <span class="material-icons text-6xl text-gray-400 mb-md">people</span>
      <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-sm">No customers found</h3>
      <p class="text-gray-500 dark:text-gray-400">
        Try adjusting your search or filter to find what you're looking for
      </p>
    </div>
  } @else {
    <div class="bg-white dark:bg-surface-dark-secondary rounded-lg shadow overflow-hidden">
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
          <thead class="bg-gray-50 dark:bg-surface-dark-primary">
            <tr>
              <th class="px-md py-sm text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                Customer
              </th>
              <th class="px-md py-sm text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                Contact
              </th>
              <th class="px-md py-sm text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                Total Spent
              </th>
              <th class="px-md py-sm text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                Last Purchase
              </th>
              <th class="px-md py-sm text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                Status
              </th>
              <th class="px-md py-sm text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                Actions
              </th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
            @for (customer of getFilteredCustomers(); track customer.$id) {
              <tr>
                <td class="px-md py-sm whitespace-nowrap">
                  <div class="flex items-center">
                    <div class="h-10 w-10 rounded-full bg-primary-100 dark:bg-primary-900/20
                                flex items-center justify-center text-primary-700 dark:text-primary-300">
                      {{ customer.name.charAt(0).toUpperCase() }}
                    </div>
                    <div class="ml-md">
                      <div class="text-sm font-medium text-gray-900 dark:text-white">
                        {{ customer.name }}
                      </div>
                    </div>
                  </div>
                </td>
                <td class="px-md py-sm whitespace-nowrap">
                  <div class="text-sm text-gray-900 dark:text-white">{{ customer.email }}</div>
                  <div class="text-sm text-gray-500 dark:text-gray-400">{{ customer.phone }}</div>
                </td>
                <td class="px-md py-sm whitespace-nowrap">
                  <div class="text-sm text-gray-900 dark:text-white">
                    ${{ getTotalSpent(customer).toFixed(2) }}
                  </div>
                </td>
                <td class="px-md py-sm whitespace-nowrap">
                  <div class="text-sm text-gray-500 dark:text-gray-400">
                    {{ getLastPurchaseDate(customer) }}
                  </div>
                </td>
                <td class="px-md py-sm whitespace-nowrap">
                  <span class="px-sm py-xs text-xs rounded-full
                             {{ customer.status === 'active'
                                ? 'bg-success-100 text-success-800 dark:bg-success-900/20 dark:text-success-300'
                                : 'bg-gray-100 text-gray-800 dark:bg-gray-900/20 dark:text-gray-300' }}">
                    {{ customer.status }}
                  </span>
                </td>
                <td class="px-md py-sm whitespace-nowrap text-right text-sm font-medium">
                  <button
                    [routerLink]="[customer.$id, 'edit']"
                    class="text-primary-500 hover:text-primary-600 mr-md"
                  >
                    Edit
                  </button>
                  <button
                    (click)="deleteCustomer(customer.$id)"
                    class="text-error-DEFAULT hover:text-error-dark"
                  >
                    Delete
                  </button>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    </div>
  }
</div>
